"use strict";var e,t,n="[UMENG] -- ",u=(t=!1,function(){null===e&&(e=new i);return e});function i(){this.setDebug=function(e){t=e};this.d=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]);console.debug.apply(console,arguments)}catch(e){}};this.i=function(){try{if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]);console.info.apply(console,arguments)}catch(e){}}catch(e){}};this.e=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]);console.error.apply(console,arguments)}catch(e){}};this.w=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]);console.warn.apply(console,arguments)}catch(e){}};this.v=function(){if(t)try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]);console.log.apply(console,arguments)}catch(e){}};this.t=function(){if(t)try{console.table.apply(console,arguments)}catch(e){}};this.tip=function(){try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]);console.log.apply(console,arguments)}catch(e){}};this.tip_w=function(e){try{console.log("%c "+n+e,"background:red; padding: 4px; padding-right: 8px; border-radius: 4px; color: #fff;")}catch(e){}};this.err=function(){try{"string"==typeof arguments[0]&&(arguments[0]=n+arguments[0]);console.error.apply(console,arguments)}catch(e){}}}var r,s=(r=e=null,function(){return r=r||new o});function o(){var n={};this.useOpenid=function(){return!!n.useOpenid};this.useSwanid=function(){return!!n.useSwanid};this.autoGetOpenid=function(){return!!n.autoGetOpenid};this.appKey=function(){return n.appKey};this.uploadUserInfo=function(){return n.uploadUserInfo};this.enableVerify=function(){return n.enableVerify};this.set=function(e){n=e};this.get=function(){return n};this.setItem=function(e,t){n[e]=t};this.getItem=function(e){return n[e]}}function a(){this.listeners={};this.maxListener=50}a.prototype.addListener=a.prototype.on=function(e,t){var n=this.listeners;n[e]&&n[e].length>=this.maxListener?console.error("监听器的最大数量是%d,您已超出限制",this.maxListener):n[e]instanceof Array?-1===n[e].indexOf(t)&&n[e].push(t):n[e]=[].concat(t)};a.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments);t.shift();var n=this.listeners;n[e]instanceof Array&&n[e].forEach(function(e){e.apply(null,t)})};a.prototype.listeners=function(e){return this.listeners[e]};a.prototype.setMaxListeners=function(e){this.maxListener=e};a.prototype.removeListener=function(e,t){var n=this.listeners,t=(n[e]||[]).indexOf(t);0<=t&&n[e].splice(t,1)};a.prototype.removeAllListener=function(e){this.listeners[e]=[]};a.prototype.once=function(n,i){var r=this;this.on(n,function e(){var t=Array.prototype.slice.call(arguments);i.apply(null,t);r.removeListener(n,e)})};var c=new a;c.messageType={CONFIG_LOADED:0,UMA_LIB_INITED:1};var f=new(function(){function e(){}e.prototype.setStorage=function(e,t,n){qq.setStorage({key:e,data:t,success:function(){"function"==typeof n&&n(!0)},fail:function(){"function"==typeof n&&n(!1)}})};e.prototype.getStorage=function(t,n){qq.getStorage({key:t,success:function(e){"function"==typeof n&&n(e.data)},fail:function(e){u().w(t+": "+e.errMsg);"function"==typeof n&&n()}})};e.prototype.removeStorage=function(e,t){qq.removeStorage({key:e,success:function(){"function"==typeof t&&t(!0)},fail:function(){"function"==typeof t&&t(!1)}})};e.prototype.getSystemInfo=function(i){qq.getSystemInfo({success:function(e){var t={model:e.model,brand:e.brand,pixelRatio:e.pixelRatio,screenWidth:e.screenWidth,screenHeight:e.screenHeight,fontSizeSetting:e.fontSizeSetting,platform:e.platform,platformVersion:e.version,platformSDKVersion:e.SDKVersion,language:e.language,deviceName:e.model,resolution:""},n=e.system.split(" ");if(Array.isArray(n)){t.OS=n[0];t.OSVersion=n[1]}n=Math.round(e.screenWidth*e.pixelRatio),e=Math.round(e.screenHeight*e.pixelRatio);t.resolution=e<n?n+"*"+e:e+"*"+n;"function"==typeof i&&i(t)},fail:function(){"function"==typeof i&&i()}})};e.prototype.getDeviceInfo=function(e){"function"==typeof e&&e("")};e.prototype.checkNetworkAvailable=function(t){qq.getNetworkType({success:function(e){"function"==typeof t&&t(e&&"none"!==e.networkType)},fail:function(){"function"==typeof t&&t(!1)}})};e.prototype.getNetworkInfo=function(t){qq.getNetworkType({success:function(e){"function"==typeof t&&t({networkAvailable:"none"!==e.networkType,networkType:e.networkType})},fail:function(){"function"==typeof t&&t()}})};e.prototype.getDeviceId=function(e){e("")};e.prototype.getAdvertisingId=function(e){"function"==typeof e&&e("")};e.prototype.onNetworkStatusChange=function(t){qq.onNetworkStatusChange(function(e){"function"==typeof t&&t(e.isConnected||!0)})};e.prototype.request=function(e){var t=e.success,n=e.fail,i=!1,r=null;e.success=function(e){if(!i){r&&clearTimeout(r);"function"==typeof t&&t(e)}};e.fail=function(){if(!i){r&&clearTimeout(r);"function"==typeof n&&n(!1)}};qq.request(e);r=setTimeout(function(){r&&clearTimeout(r);i=!0;"function"==typeof n&&n(i)},e.timeout||5e3)};e.prototype.getSdkType=function(){return"qqmp"};e.prototype.getPlatform=function(){return"qq"};e.prototype.getUserInfo=function(t){var n={fail:function(){t&&t()},success:function(e){if(e&&e.userInfo){e=e.userInfo;t&&t({avatar:e.avatarUrl,nickName:e.nickName,gender:e.gender,country:e.country,province:e.province,city:e.city,language:e.language})}}};try{qq.getSetting({success:function(e){e.authSetting["scope.userInfo"]&&qq.getUserInfo(n)},fail:function(){t()}})}catch(e){u.e("getUserInfo error",e)}};e.prototype.getAppInfoSync=function(){if(qq.getAccountInfoSync){var e=qq.getAccountInfoSync(),e=e&&e.miniProgram?e.miniProgram:{};return{appId:e.appId,appEnv:e.envVersion,appVersion:e.version}}return{}};e.prototype.onShareAppMessage=function(e){qq.onShareAppMessage(e)};e.prototype.shareAppMessage=function(e){qq.shareAppMessage(e)};return e}()),p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function d(e,t){p(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var h={SESSION_INTERVAL:3e4,LOG_URL:"https://umini.shujupie.com/qqm_logs",GET_OPENID_URL:"https://umini.shujupie.com/uminiprogram_logs/qq/getuut",USERINFO_URL:"https://umini.shujupie.com/uminiprogram_logs/comm/uif",DEVICE_INFO_KEY:"device_info",ADVERTISING_ID:"mobile_ad_id",ANDROID_ID:"android_id",CURRENT_SESSION:"current_session",SESSION_PAUSE_TIME:"session_pause_time",EVENT_SEND_DEFAULT_INTERVAL:15e3,EVENT_LAST_SEND_TIME:"last_send_time",MAX_EVENTID_LENGTH:128,MAX_PROPERTY_KEY_LENGTH:256,MAX_PROPERTY_KEYS_COUNT:100,REPORT_POLICY:"report_policy",REPORT_INTERVAL_TIME:"report_interval_time",REPORT_POLICY_START_SEND:"1",REPORT_POLICY_INTERVAL:"6",IMPRINT:"imprint",SEED_VERSION:"1.0.0",IMPL_VERSION:"2.5.2",ALIPAY_AVAILABLE_VERSION:"10.1.52",SHARE_PATH:"um_share_path",SHARES:"shares",REQUESTS:"requests",UUID:"um_uuid",UUID_SUFFIX:"ud",OPENID:"um_od",UNIONID:"um_unid",ALIPAYID:"um_alipayid",USERID:"um_userid",PROVIDER:"um_provider",SWANID:"um_swanid",ANONYMOUSID:"um_anonymousid",LAUNCH_OPTIONS:"LAUNCH_OPTIONS",UM_SSRC:"_um_ssrc",USER_INFO:"user_info",IS_ALIYUN:!1,ALIYUN_URL:"serverless.huoban.youmeng.network.forward"};var l,g,_={isNumber:function(e){return!Number.isNaN(parseInt(e,10))},compareVersion:function(e,t){for(var n=String(e).split("."),i=String(t).split("."),r=0;r<Math.max(n.length,i.length);r++){var o=parseInt(n[r]||0,10),s=parseInt(i[r]||0,10);if(s<o)return 1;if(o<s)return-1}return 0},getRandomStr:function(e){for(var t="",n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],i=0;i<Number(e);i++)t+=n[Math.round(Math.random()*(n.length-1))];return t},clone:function(e){return JSON.parse(JSON.stringify(e))},startsWith:function(e,t){return!(!e||!t||0===t.length||t.length>e.length)&&e.substr(0,t.length)===t},endsWith:function(e,t){return!(!t||0===e.length||t.length>e.length)&&e.substring(e.length-t.length)===t},assign:function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},deepEqual:function e(t,n){if(t===n)return!0;if(t&&"object"==typeof t&&n&&"object"==typeof n){if(Object.keys(t).length!==Object.keys(n).length)return!1;for(var i in t){if(Object.prototype.hasOwnProperty.call(n,i))return!1;if(!e(t[i],n[i]))return!1}return!0}return!1},trimStart:function(e,t){if(!e)return"";if("string"==typeof t&&t.length){t=new RegExp("^"+t+"*");e=e.replace(t,"")}else e=e.replace(/^s*/,"");return e},trimEnd:function(e,t){if(!e)return"";var n,i;if("string"==typeof t&&t.length){n=new RegExp(t);i=e.length;for(;n.test(e.charAt(i));)--i;return e.slice(0,i+1)}n=/s/;i=e.length-1;for(;n.test(e.charAt(i));)--i;return e.slice(0,i+1)},isFunction:function(e){return"function"==typeof e}},v=function(e){d(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}t.prototype.getOpenIdAsync=function(t,n){var i=this;qq.login({success:function(e){e.code?f.request({url:h.GET_OPENID_URL,method:"GET",data:{key:t,code:e.code},success:function(e){u().v(" request ss ",e);if(e&&200===e.statusCode&&e.data&&e.data.data){e=e.data.data;i.setOpenid(e.oid);i.setUnionid(e.uid);return n&&n(e)}n&&n()},fail:function(e){u().v(" request failed...",e);n&&n()}}):n&&n()},fail:function(){n&&n()}})};return t}(function(t){d(e,t);function e(){var e=null!==t&&t.apply(this,arguments)||this;e._openid="";e._unionid="";e._useOpenid=!1;return e}e.prototype.initID=function(t){var n=this;n._idType=n._useOpenid?"openid":"uuid";u().v("id type: ",n._idType);f.getStorage(h.UNIONID,function(e){n._unionid=e});this._useOpenid?f.getStorage(h.OPENID,function(e){n._openid=e;t&&t()}):t&&t()};e.prototype.setUseOpenid=function(e){this._useOpenid=e};e.prototype.setOpenid=function(e){if(!this._openid&&e){this._openid=e;f.setStorage(h.OPENID,e)}};e.prototype.setUnionid=function(e){if(!this._unionid&&e){this._unionid=e;f.setStorage(h.UNIONID,e)}};e.prototype.getIdTracking=function(){var e=t.prototype.getIdTracking.call(this);this._openid&&(e.openid=this._openid);this._unionid&&(e.unionid=this._unionid);this._userid&&(e.userid=this._userid);return e};e.prototype.getId=function(){return this._useOpenid?this._openid:this._uuid};return e}(function(){function e(){this._uuid="";this._userid="";this._provider="";this._idType=""}e.prototype.createUUID=function(){return _.getRandomStr(10)+Date.now()+_.getRandomStr(7)+h.UUID_SUFFIX};e.prototype.initUUID=function(t){var n=this;f.getStorage(h.UUID,function(e){if(e)n._uuid=e;else{n._uuid=n.createUUID();f.setStorage(h.UUID,n._uuid)}t&&t(e)})};e.prototype.initUserid=function(){var t=this;f.getStorage(h.USERID,function(e){if(!t._userid&&e){t._userid=e;u().v("userId is ",e)}});f.getStorage(h.PROVIDER,function(e){if(!t._provider&&e){t._provider=e;u().v("provider is ",e)}})};e.prototype.init=function(e){var t=this;t.initUUID(function(){t.initUserid();t.initID(e)})};e.prototype.setUserid=function(e,t){if(!this._userid&&e){this._userid=e;this._provider=t;f.setStorage(h.USERID,e);f.setStorage(h.PROVIDER,t)}};e.prototype.getUserId=function(){return this._userid};e.prototype.getProvider=function(){return this._provider};e.prototype.getIdType=function(){return this._idType};e.prototype.getIdTracking=function(){var e={};this._uuid&&(e.uuid=this._uuid);this._userid&&(e.userid=this._userid);return e};return e}())),y=function(){return l=l||new v},m=function(){return g=g||new S};function S(){var t=!1,n=null,i=[];this.addPageStart=function(e){if(e&&!t){n={ts:Date.now(),path:e,page_name:e};t=!0}};this.addPageEnd=function(e){if(t&&e&&n&&e===n.page_name){e=Date.now()-n.ts;n.duration=Math.abs(e);i.push(n);n=null;t=!1}};this.get=function(){return i};this.getCurrentPage=function(){return n};this.clear=function(){i.length=0}}var I={};function E(){return function(e){var t,n=[];for(t in e)"_um_ssrc"!==t&&"_um_sts"!==t&&n.push(t+"="+e[t]);return n.join("&")}(I)}var A,O,T,N=function(){return A=A||new U};function U(){return{add:function(e,t){u().v("share origin: %o",e);var n={title:e&&e.title,path:e&&e.path&&e.path.split("?")[0],_um_sts:Date.now()};n.path&&1<n.path.length&&_.startsWith(n.path,"/")&&(n.path=_.trimStart(n.path,"/"));var i=e.path||"",r=y().getId();if(r){var o=T.split(","),s=(o=o.filter(function(e){return 0<e.length})).indexOf(r);0<=s&&(o=o.slice(0,s));o.length<3&&o.push(r);r=o.join(",");-1!==i.indexOf("?")?i+="&_um_ssrc="+r:i+="?_um_ssrc="+r;o=Date.now();i+="&_um_sts="+o;if(t){t=E(),t=t?t+"&_um_ssrc="+r+"&_um_sts="+o:"_um_ssrc="+r+"&_um_sts="+o;e.query=e.query?e.query+"&_um_ssrc="+r+"&_um_sts="+o:t}else e.path=i;n._um_ssrc=r;n._um_sts=o}O.push(n);u().v("share: %o",e);return e},setShareSource:function(e){T=e},clear:function(){O.length=0},get:function(){return O}}}var R,k,w,P,L={stringify:function(e){if(e)try{return JSON.stringify(e)}catch(e){}return""},parse:function(e){if(e)try{return JSON.parse(e)}catch(e){}return null},parseToArray:function(e){if(e)try{return JSON.parse(e)}catch(e){}return[]}},D=(P=!(O=[]),function(){return R=R||new b});function b(){this.load=function(t){if(w){f.removeStorage(k);t()}else{k="um_cache_"+s().appKey();f.getStorage(k,function(e){w=L.parse(e)||{};P=!0;f.removeStorage(k);t()})}};this.save=function(){w&&f.setStorage(k,L.stringify(w))};this.set=function(e,t){w&&(w[e]=t)};this.get=function(e){return(w||{})[e]};this.remove=function(e){w&&w[e]&&delete w[e]};this.getAll=function(){return w};this.clear=function(){w=null};this.has=function(e){return!!this.get(e)};this.isLoaded=function(){return P}}var q,C,M,V,x="ekvs",j=1e4,F=(M=[],V=[],function(){return q=q||{addEvent:function(e){if(C){M.unshift(e);if(1<M.length){G();M.length=0}}else{u().w("session id is null: ",C);V.unshift(e)}},setSessionId:function(e){C=e;u().v("setSessionId: ",C);if(Array.isArray(V)&&V.length&&C){for(var t=0;t<V.length;t++)this.addEvent(V[t]);V.length=0}},getEkvs:function(){var e=D().get(x);M&&M.length&&(e=H(e,M));return e},clear:function(){D().remove(x);M.length=0}}});function G(){if(M.length){var e=D().get(x);if(function(e){var t,n=0;for(t in e)Array.isArray(e[t])&&(n+=e[t].length);return n}(e)+M.length<=j){e=H(e,M);D().set(x,e)}}}function H(e,t){var n=(e=e||{})[C];Array.isArray(n)&&n.length?e[C]=n.concat(t):e[C]=[].concat(t);return e}var K,Y="2g",X="3g",z="4g",W={HALF_SESSION:"half_session",CLOSE_SESSION:"close_session",EKV:"ekv",ENTER_PAGE:"enter_page",LEAVE_PAGE:"leave_page"},J=["access","access_subtype"],Q={instance:function(){return K=K||B()}};function B(){var e=!1,r={};function t(n){var e=D().get(h.IMPRINT);e&&(r.imprint=e);r.device_type="Phone";r.sdk_version=h.IMPL_VERSION;r.appkey=s().appKey();f.getDeviceInfo(function(e){r.device_info=e||""});e=f.getAppInfoSync();r.appid=e.appId;r.app_env=e.appEnv;r.app_version=e.appVersion;f.getSystemInfo(function(t){f.getNetworkInfo(function(e){e=function(e,t){var n={},i=(t=t||{}).networkType;"none"===i&&(i="unknown");var r=(e=e||{}).model||"",o=e.platform||"",s=e.brand||"",t=s.toLowerCase();n.sdk_type=f.getSdkType();n.platform=f.getPlatform();n.platform_sdk_version=e.platformSDKVersion;n.platform_version=e.platformVersion;n.resolution=e.resolution;n.pixel_ratio=e.pixelRatio;n.os=o;n.font_size_setting=e.fontSizeSetting;n.device_model=r;n.device_brand=s;n.device_manufacturer=t;n.device_manuid=r;n.device_name=r;n.os_version=e.OSVersion;n.language=e.language;switch(i=i?i.toLowerCase():""){case z:n.access_subtype="LTE";n.access="4G";break;case X:n.access_subtype="CDMA";n.access="3G";break;case Y:n.access_subtype="GRPS";n.access="2G";break;default:n.access=i;delete n.access_subtype}return n}(t,e);_.assign(r,e);!function(){var e=[];if(void 0){e.push({name:"系统名",value:r.platform});e.push({name:"支付宝版本号",value:r.platform_version})}e.push({name:"设备型号",value:r.device_model});e.push({name:"设备生产商",value:r.device_brand});e.push({name:"os版本号",value:r.os_version});e.push({name:"网络类型",value:r.access});e.push({name:"运营商",value:r.access_subtype});e.push({name:"分辨率",value:r.resolution});e.push({name:"pixelRatio",value:r.pixel_ratio});for(var t="",n=0;n<e.length;n++){var i=e[n];t+=i.name+": "+i.value+"; "}u().v("调试辅助信息: ",t)}();n&&n()})})}return{init:function(){t(function(){e=!0})},isLoaded:function(){return e},get:function(){return r},getRealtimeFields:function(){var t={};J.forEach(function(e){t[e]=r[e]});return t},setIdTracking:function(e){this.setItem("id_tracking",e)},setIdType:function(e){this.setItem("id_type",e)},setAppVersion:function(e){this.setItem("app_version",e)},setSuperProperty:function(e){r.sp||(r.sp={});r.sp.isv=e},getSuperProperty:function(){return r&&r.sp?r.sp.isv:""},setItem:function(e,t){r[e]=t},getItem:function(e){return r[e]}}}var Z,$,ee,te=(ee=$=Z=K=w=R=A=g=l=null,function(){return Z=Z||ne()});function ne(){return{resume:function(e){var t=!1;ee=ee||D().get(h.CURRENT_SESSION);var n=new Date;$=n.getTime();if(!ee||!ee.end_time||$-ee.end_time>h.SESSION_INTERVAL){t=!0;!function(e){try{var t=(ee||{}).options||{},n=_.assign({},function(e){var t,n={};for(t in e)0===t.indexOf("_um_")&&(n[t]=e[t]);u().v("query: ",e);u().v("_um_params: ",n);return n}(e.query));n.path=e.path||t.path;n.scene=e.scene?f.getPlatform()+"_"+e.scene:t.scene;t=e.referrerInfo;t&&(n.referrerAppId=t.appId);u().v("session options: ",n);t=n[h.UM_SSRC];t&&N().setShareSource(t);t=Date.now();ee={id:_.getRandomStr(10)+t,start_time:t,options:n}}catch(e){u().e("生成新session失败: ",e)}}(e);u().v("开始新的session(%s): ",ee.id,ee)}else u().v("延续上一次session(%s): %s ",ee.id,n.toLocaleTimeString(),ee);return t},pause:function(){!function(){if(ee){var e=new Date;ee.end_time=e.getTime();"number"!=typeof ee.duration&&(ee.duration=0);ee.duration=ee.end_time-$;D().set(h.CURRENT_SESSION,ee);u().v("退出会话(%s): %s ",ee.id,e.toLocaleTimeString(),ee)}}()},getCurrentSessionId:function(){return(ee||{}).id},getCurrentSession:function(){return ee},cloneCurrentSession:function(){return _.clone(ee)}}}function ie(e){var t=null;switch(e){case W.HALF_SESSION:t=function(){var e=null,t=te().cloneCurrentSession();t&&(e={header:{st:"1"},analytics:{sessions:[t]}});return e}();break;case W.CLOSE_SESSION:t=function(){var e=null,t={},n=te().cloneCurrentSession();if(n){var i=m().get(),r=N().get();Array.isArray(i)&&i.length&&(n.pages=_.clone(i));Array.isArray(r)&&r.length&&(n.shares=_.clone(r));m().clear();N().clear();t.sessions=[n]}n=F().getEkvs();if(n){t.ekvs=_.clone(n);F().clear()}(t.sessions||t.ekvs)&&(e={analytics:t});return e}();break;case W.EKV:t=function(){var e=null,t=F().getEkvs();if(t){e={analytics:{ekvs:_.clone(t)}};F().clear()}return e}()}return t}var re={sessions:"sn",ekvs:"e",active_user:"active_user"},oe={sdk_type:"sdt",access:"ac",access_subtype:"acs",device_model:"dm",language:"lang",device_type:"dt",device_manufacturer:"dmf",device_name:"dn",platform_version:"pv",id_type:"it",font_size_setting:"fss",os_version:"ov",device_manuid:"did",platform_sdk_version:"psv",device_brand:"db",appkey:"ak",_id:"id",id_tracking:"itr",imprint:"imp",sdk_version:"sv",resolution:"rl",testToken:"ttn"},se={uuid:"ud",unionid:"und",openid:"od",anonymousid:"nd",alipay_id:"ad",device_id:"dd",userid:"puid"};function ue(e){return{h:function(e,t){var n=ae(e,t);e&&e.id_tracking&&(n[t.id_tracking||"id_tracking"]=ae(e.id_tracking,se));return n}(e.header,oe),a:function(e,t){var n={};if(e)for(var i in e)e[i]&&(n[t[i]]=e[i]);return n}(e.analytics,re)}}function ae(e,t){var n,i={};for(n in e)t[n]?i[t[n]]=e[n]:i[n]=e[n];return i}var ce=k=T="";function fe(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?ye(192|t>>>6)+ye(128|63&t):ye(224|t>>>12&15)+ye(128|t>>>6&63)+ye(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return ye(240|t>>>18&7)+ye(128|t>>>12&63)+ye(128|t>>>6&63)+ye(128|63&t)}function pe(e){var t=[0,2,1][e.length%3],e=e.charCodeAt(0)<<16|(1<e.length?e.charCodeAt(1):0)<<8|(2<e.length?e.charCodeAt(2):0);return[_e.charAt(e>>>18),_e.charAt(e>>>12&63),2<=t?"=":_e.charAt(e>>>6&63),1<=t?"=":_e.charAt(63&e)].join("")}function de(e){return e.replace(me,fe).replace(/[\s\S]{1,3}/g,pe)}function he(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return ye(55296+(t>>>10))+ye(56320+(1023&t));case 3:return ye((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return ye((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}}function le(e){var t=e.length,n=t%4,e=(0<t?ve[e.charAt(0)]<<18:0)|(1<t?ve[e.charAt(1)]<<12:0)|(2<t?ve[e.charAt(2)]<<6:0)|(3<t?ve[e.charAt(3)]:0);(e=[ye(e>>>16),ye(e>>>8&255),ye(255&e)]).length-=[0,0,2,1][n];return e.join("")}function ge(e){return e.replace(/[\s\S]{1,4}/g,le).replace(Se,he)}var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ve=function(e){for(var t={},n=0,i=e.length;n<i;n++)t[e.charAt(n)]=n;return t}(_e),ye=String.fromCharCode,me=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Se=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),Ie={encode:function(e,t){return t?de(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):de(String(e))},decode:function(e){return ge(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}};var Ee=new function(){var t="",n=this;this.set=function(e){t=e};this.get=function(){return t};this.getImpObj=function(){return L.parse(Ie.decode(t))};this.getItem=function(e){var t=n.getImpObj();return t&&t[e]||""};this.load=function(){t=D().get(h.IMPRINT)};this.save=function(){t&&D().set(h.IMPRINT,t)}};function Ae(n,i,r,e){Q.instance().setIdType(y().getIdType());Q.instance().setIdTracking(y().getIdTracking());var t=y().getUserId();t&&n.analytics&&(n.analytics.active_user={puid:t,provider:y().getProvider()});t=_.clone(Q.instance().get());n.header=_.assign(t,n.header,{ts:Date.now(),testToken:ce,traceId:_.getRandomStr(10)+Date.now()+_.getRandomStr(9)});var t=ue(n),o=L.stringify(t),t={url:h.LOG_URL,method:"POST",data:Ie.encode(o),success:function(e){var t=e.code||e.status||e.statusCode;if(200===t||413===t){u().i("数据发送成功: ",n,o);!function(e){if(e){Q.instance().setItem(h.IMPRINT,e);Ee.set(e);Ee.save();u().v("imprint: ",Ee.getImpObj());Ee.getItem("ttn_invalid")&&(ce="")}}((e.data||{}).imprint);"function"==typeof i&&i(e)}else{u().w("数据发送失败: ",o);"function"==typeof r&&r()}},fail:function(e){u().w("超时: ",o);"function"==typeof r&&r()},complete:function(){"function"==typeof e&&e()}};f.request(_.assign(t,{header:{"Content-Type":t=f.getSdkType()+"/json","Msg-Type":t}}))}function Oe(e){var t=e,n=[];this.enqueue=function(e){"number"==typeof t&&this.size()>=t&&this.dequeue();n.push(e)};this.dequeue=function(){return n.shift()};this.front=function(){return n[0]};this.isEmpty=function(){return 0===n.length};this.clear=function(){n.length=0};this.size=function(){return n.length};this.items=function(){return n};this.print=function(){console.log(n.toString())}}var Te,Ne,Ue,Re,ke=(Te=null,Ne=!1,Ue=[],Re=new Oe(50),function(){return Te=Te||new Le});function we(t){var e=Re.front();if(e)Ae(e,function(){Re.dequeue();we(t)},function(){var e=Re.dequeue();e&&!e.noCache&&Ue.push(e);we(t)});else{!function(){Ue.forEach(function(e){Re.enqueue(e)});Ue.length=0}();t()}}function Pe(e){if(y().getId())if(Ne)u().i("队列正在发送中");else{Ne=!0;we(function(){Ne=!1;"function"==typeof e&&e()})}else{u().i("获取id标识失败，暂缓发送");"function"==typeof e&&e()}}function Le(){this.send=function(e,t,n){e?this.add(e,t,function(){Pe(n)}):Pe(n)};this.add=function(e,t,n){!function e(t,n,i){if(Q.instance().isLoaded()){n=n||{};var r=ie(t);if(r){var o=Q.instance().getRealtimeFields();r.header=_.assign({},r.header,o);r.noCache=n.noCache;Re.enqueue(r)}"function"==typeof i&&i()}else setTimeout(function(){e(t,n,i)},100)}(e,t,n)};this.load=function(){var e=D().get(h.REQUESTS);e&&e.length&&e.forEach(function(e){Re.enqueue(e)});D().remove(h.REQUESTS)};this.save=function(){D().set(h.REQUESTS,_.clone(Re.items()));Re.clear()}}var De,be=(De=null,function(){return De=De||new qe});function qe(){this.update=function(){f.getUserInfo(function(t){if(t){var e=D().get(h.USER_INFO);e&&_.deepEqual(t,e)||function(t,n){var e=s().appKey(),i=f.getSdkType(),r=y().getId(),o=y().getIdType();if(e&&i&&r&&o){o={ak:s().appKey(),sdt:f.getSdkType(),uin:t.nickName,uia:t.avatar,uig:t.gender,uit:t.country,uip:t.province,uic:t.city,uil:t.language,id:y().getId(),it:y().getIdType()},o=JSON.stringify(o);o=Ie.encode(o);f.request({url:h.USERINFO_URL,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:"ui="+o,success:function(e){u().v("用户信息上传成功: ",t);n&&n(e&&e.data&&200===e.data.code)},fail:function(){u().e("用户信息上传失败: ",t);n&&n(!1)}})}}(t,function(e){e&&D().set(h.USER_INFO,t)})}})}}function Ce(e,t){this.id=e;this.ts=Date.now();var n=typeof t;if("string"==n&&t)this[e]=t;else if("object"==n)for(var i in t)!{}.hasOwnProperty.call(t,i)||(this[i]=t[i])}function Me(){var r=!1,n=!1,o=0;this.init=function(e){u().v("sdk version: "+h.IMPL_VERSION);r?u().v("Lib重复实例化"):D().load(function(){u().v("cache初始化成功: ",D().getAll());!function(){y().setUseOpenid&&y().setUseOpenid(s().useOpenid());y().init(function(){Q.instance().init();u().v("Header初始化成功")})}();r=!0;"function"==typeof e&&e();u().tip("SDK集成成功")})};this.resume=function(e){if(r&&!n){u().v("showOptions: ",e);var t;n=!0;s().enableVerify()&&e&&e.query&&(t=e.query._ttn,ce=t||ce);this._resume(e)}};this._resume=function(e){ke().load();var t=te().resume(e),e=te().getCurrentSessionId();F().setSessionId(e);t&&ke().add(W.HALF_SESSION,{},function(){y().setUseOpenid&&y().setUseOpenid(s().useOpenid());if(s().useOpenid()&&s().autoGetOpenid()&&!y().getId()){u().v("get id async");!function t(n,i){if(y().getId()||n<=0)return;y().getOpenIdAsync(s().appKey(),function(e){if(e){u().v("获取id成功");ke().send()}else{u().v("获取openid失败,启动重试,剩余可用次数",n-1);setTimeout(function(){t(n-1,i)},i)}})}(10,3e3)}else{u().v("session auto send");ke().send()}})};this.pause=function(e){if(r){n=!1;o=0;te().pause();s().uploadUserInfo()&&be().update();ke().send(W.CLOSE_SESSION,{},function(){ke().save();D().save();u().v("cache save success");"function"==typeof e&&e()})}};this.setOpenid=function(e){u().v("setOpenId: %s",e);y().setOpenid(e);ke().send()};this.setUnionid=function(e){u().v("setUnionid: %s",e);y().setUnionid(e)};this.setUserid=function(e,t){u().v("setUserid: %s",e,t);y().setUserid(e,t)};this.setAnonymousid=function(e){u().v("setAnonymousId: %s",e);y().setAnonymousid(e);ke().send()};this.setAppVersion=function(e){e&&"string"!=typeof e?u().w("setAppVersion方法只接受字符串类型参数"):Q.instance().setAppVersion(e)};this.setAlipayUserid=function(e){if(e&&"string"!=typeof e)u().w("setAlipayUserid方法只接受字符串类型参数");else{u().v("setAlipayUserid: %s",e);y().setAlipayUserid(e)}};this.setSuperProperty=function(e){if(e&&"string"!=typeof e)u().w("超级属性只支持字符串类型");else{var t=this;if(Q.instance().getSuperProperty()!==e){Q.instance().setSuperProperty(e);t.pause(function(){t.resume()})}}};this.trackEvent=function(e,t){if(r){u().v("event: ",e,t);if(function(e,t){if(e&&"string"==typeof e){var n=["id","ts","du"],i={};n.forEach(function(e){i[e]=1});if(i[e])u().e("eventId不能与以下保留字冲突: "+n.join(","));else if(e.length>h.MAX_EVENTID_LENGTH)u().e("The maximum length of event id shall not exceed "+h.MAX_EVENTID_LENGTH);else{if(!t||"object"==typeof t&&!Array.isArray(t)||"string"==typeof t){if("object"==typeof t){var r,o=0;for(r in t)if({}.hasOwnProperty.call(t,r)){if(r.length>h.MAX_PROPERTY_KEY_LENGTH){u().e("The maximum length of property key shall not exceed "+h.MAX_PROPERTY_KEY_LENGTH);return}if(o>=h.MAX_PROPERTY_KEYS_COUNT){u().e("The maximum count of properties shall not exceed "+h.MAX_PROPERTY_KEYS_COUNT);return}if(i[r]){u().e("属性中的key不能与以下保留字冲突: "+n.join(","));return}o+=1}}return 1}u().e("please check trackEvent properties. properties should be string or object(not include Array)")}}else u().e('please check trackEvent id. id should be "string" and not null')}(e,t)){var n=new Ce(e,t);F().addEvent(n);var i=!!ce,e=i?0:h.EVENT_SEND_DEFAULT_INTERVAL,t=Date.now();if(n=t,e=e,"number"!=typeof o||"number"!=typeof e||(o<=0||e<n-o)){o=t;ke().send(W.EKV,{noCache:i},function(){})}}}};this.trackShare=function(e){if(r){try{if(-1<f.getSdkType().indexOf("game")){e=N().add(e,!0);u().v("shareQuery: ",e)}else{e=N().add(e,!1);u().v("sharePath: ",e.path)}}catch(e){u().v("shareAppMessage: ",e)}return e}};this.trackPageStart=function(e){r&&m().addPageStart(e)};this.trackPageEnd=function(e){r&&m().addPageEnd(e)};this.onShareAppMessage=function(e){var t=this;f.onShareAppMessage(function(){return t.trackShare(e())})};this.shareAppMessage=function(e){this.trackShare(e);f.shareAppMessage(e)}}var Ve=[];function xe(){}xe.prototype={createMethod:function(e,t,n){try{e[t]=n&&n[t]?function(){return n[t].apply(n,arguments)}:function(){Ve.push([t,[].slice.call(arguments)])}}catch(e){u().v("create method errror: ",e)}},installApi:function(e,t){try{for(var n="resume,pause,trackEvent,trackPageStart,trackPageEnd,trackShare,setUserid,setOpenid,setUnionid".split(","),i=0,r=n.length;i<r;i++)this.createMethod(e,n[i],t);if(t)for(i=0,r=Ve.length;i<r;i++){var o=Ve[i];try{t[o[0]].apply(t,o[1])}catch(e){u().v("impl[v[0]].apply error: ",o[0],e)}}}catch(e){u().v("install api errror: ",e)}}};var je=["https://umini.shujupie.com","https://ulogs.umeng.com"],Fe=0;function Ge(t,e){if(t>=je.length||e){e&&function(){var e="https://umini.shujupie.com";h.LOG_URL=h.LOG_URL.replace(e,je[Fe]);h.GET_OPENID_URL=h.GET_OPENID_URL.replace(e,je[Fe]);h.USERINFO_URL=h.USERINFO_URL.replace(e,je[Fe])}();e&&u().v("命中可用服务",je[Fe]);e||u().tip_w("未命中可用服务")}else f.request({url:je[t]+"/uminiprogram_logs/ckdh",success:function(e){200===(e.code||e.status||e.statusCode)&&e.data&&200===e.data.code?Ge((Fe=t)+1,!0):Ge(t+1,!1)},fail:function(){Ge(t+1,!1)}})}({init:function(e){setTimeout(function(){Ge(0,!1)},e)}}).init(3e3);var He=new xe,Ke={_inited:!1,_log:u(),use:function(e,t){e&&_.isFunction(e.install)?e.install(Ke,t):_.isFunction(e)&&e(Ke,t);return Ke},messager:c,init:function(e){if(this._inited)u().v("已经实例过，请避免重复初始化");else if(e)if(e.appKey){"boolean"!=typeof e.useOpenid&&(e.useOpenid=!0);s().set(e);u().setDebug(e.debug);this._inited=!0;var t=this;c.emit(c.messageType.CONFIG_LOADED,e);try{var n=new Me;u().v("成功创建Lib对象");n.init(function(){u().v("Lib对象初始化成功");He.installApi(t,n);u().v("安装Lib接口成功");c.emit(c.messageType.UMA_LIB_INITED,e)})}catch(e){u().w("创建Lib对象异常: "+e)}}else u().err("请确保传入正确的appkey");else u().err("请正确设置相关信息！")}};try{He.installApi(Ke,null)}catch(e){u().w("uma赋值异常: ",e)}var Ye="",Xe={};function ze(e){e&&(Ye=e)}function We(){return function(e,t){if(!e)return"";var n,i=[];for(n in t)"_um_ssrc"!==n&&"_um_sts"!==n&&i.push(n+"="+t[n]);var r=i.join("&");return r?e+"?"+r:e}(Ye,Xe[Ye])}function Je(e,n){if(e.onShareAppMessage){var i=e.onShareAppMessage;e.onShareAppMessage=function(e){var t=i.call(this,e)||{},e=We();!t.path&&e&&(t.path=e);return n.trackShare.call(this,t)}}}function Qe(e,t,n){var i=e[t];e[t]=function(e){n.call(this,e);i&&i.call(this,e)}}function Be(e){try{Ke.resume(e,!0)}catch(e){u().v("onAppShow: ",e)}}function Ze(){try{Ke.pause()}catch(e){u().v("onAppHide: ",e)}}function $e(e){try{ze(this.route);e&&(t=this.route,n=e,t&&(Xe[t]=n));u().v("Page onLoad: ",this.route,e)}catch(e){u().v("onPageLoad: ",e)}var t,n}function et(){try{ze(this.route);Ke.trackPageStart(this.route)}catch(e){u().v("onPageShow: ",e)}}function tt(){try{Ke.trackPageEnd(this.route)}catch(e){u().v("onPageHide: ",e)}}try{var nt=App;App=function(e){Qe(e,"onLaunch",function(){!function(e){try{Ke.init(e)}catch(e){u().v("onAppLaunch: ",e)}}(e.umengConfig)});Qe(e,"onShow",Be);Qe(e,"onHide",Ze);nt(e)}}catch(e){u().w("App重写异常")}try{var it=Page;Page=function(e){Qe(e,"onShow",et);Qe(e,"onHide",tt);Qe(e,"onUnload",tt);Qe(e,"onLoad",$e);Je(e,Ke);it(e)}}catch(e){u().w("Page重写异常")}try{var rt=Component;Component=function(t){try{t.methods=t.methods||{};var e=t.methods;Qe(e,"onShow",et);Qe(e,"onHide",tt);Qe(e,"onUnload",tt);Qe(e,"onLoad",$e);Je(e,Ke);rt(t)}catch(e){rt(t)}}}catch(e){u().w("Component重写异常")}var ot=Ke.init;Ke.init=function(e){if(e&&e.useOpenid){u().tip_w("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!");u().tip_w("您选择了使用openid进行统计，请确保使用setOpenid回传openid或通过设置autoGetOpenid为true，并在友盟后台设置secret由友盟帮您获取");u().tip_w("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")}ot.call(Ke,e)};qq.uma=Ke;module.exports=Ke;
